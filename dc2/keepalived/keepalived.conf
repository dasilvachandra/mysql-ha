global_defs {
  script_user root
  enable_script_security
}

# Cek MySQL DC2: sukses hanya jika read_only=0 (siap menulis)
vrrp_script chk_mysql {
  script "/etc/keepalived/scripts/is_primary.sh"
  interval 5
  timeout 3
  fall 2
  rise 1
}

vrrp_instance VI_DB {
  state BACKUP
  initial_state BACKUP
  interface wg0
  virtual_router_id 51
  priority 150
  advert_int 1
  nopreempt

  authentication {
    auth_type PASS
    auth_pass 1234
  }

  unicast_src_ip 10.7.0.5
  unicast_peer {
    10.7.0.4
  }

  virtual_ipaddress {
    10.7.0.10/32 dev wg0 label wg0:vip
  }

  track_script {
    chk_mysql
  }

  track_interface {
    wg0
  }

  garp_master_delay 1
  garp_master_repeat 5
  garp_master_refresh 10
  garp_master_refresh_repeat 2

  notify_master "/etc/keepalived/scripts/notify.sh master"
  notify_backup "/etc/keepalived/scripts/notify.sh backup"
  notify_fault  "/etc/keepalived/scripts/notify.sh fault"
}
